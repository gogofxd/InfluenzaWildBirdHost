import pandas as pd

# Read the Excel file and select 'Tabelle1' sheet
df = pd.read_excel('gisaid_epiflu_isolates_xxx.xls', sheet_name='Tabelle1')

# Extract the second part from 'Isolate_Name' as 'Strain_Host'
df['Strain_Host'] = df['Isolate_Name'].str.split('/').str[1]

# Normalize host name: lowercase, replace '-' and '_' with space
df['Strain_Host_Check_Use'] = (
    df['Strain_Host']
    .str.lower()
    .replace({'-': ' ', '_': ' '}, regex=True)
    .str.strip()
)

# Load the classification dictionary (first 7 columns only)
host_dict = pd.read_csv('Wild_Bird_Host_Classification_Dictionary.csv', usecols=range(7))

# Merge on standardized host name
merged = df.merge(host_dict, how='left',
                  left_on='Strain_Host_Check_Use',
                  right_on='Strain_Host_Check_Dictionary')

# Export the merged DataFrame to a CSV file
merged.to_csv('merged_gisaid_host_xxx.csv', index=False)

print("Merge completed. Output saved to 'merged_gisaid_host_info-2210-2409.csv'.")
